<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map Events</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #101010;
        }
        .map-container {
    display: flex;
    align-items: flex-start;
    position: relative;
    width: 100%;
    padding: 20px;
}

.map-title {
    position: absolute;
    top: 10px;
    left: 20px;
    font-size: 24px;
    font-weight: bold;
}

.map-wrapper {
    flex: 1;
    max-width: 70%;
}

.map-image {
    width: 100%;
    height: auto;
}

#popup {
    flex: 1;
    max-width: 30%;
    background: rgba(255, 255, 255, 0.95);
    padding: 15px;
    border-radius: 8px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
    display: none; /* Initially hidden */
    margin-left: 20px; /* Push popup to the right */
    font-family: Arial, sans-serif;
    transition: all 0.3s ease-in-out;
}

#popup h3 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #333;
}

#popup ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

#popup li {
    font-size: 1rem;
    padding: 5px 0;
    border-bottom: 1px solid #ddd;
}

#popup li:last-child {
    border-bottom: none;
}

/* Responsive styles */
@media (max-width: 1024px) {
    #popup {
        max-width: 40%;
        font-size: 0.9rem;
    }

    #popup h3 {
        font-size: 1.3rem;
    }

    #popup li {
        font-size: 0.9rem;
    }
}

@media (max-width: 768px) {
    #popup {
        max-width: 50%;
        padding: 10px;
    }

    #popup h3 {
        font-size: 1.2rem;
    }

    #popup li {
        font-size: 0.85rem;
    }
}

@media (max-width: 480px) {
    .map-container {
        flex-direction: column; /* Stack map and popup vertically */
        align-items: center;
    }

    #popup {
        max-width: 90%;
        margin-left: 0;
        margin-top: 15px;
        padding: 8px;
    }

    #popup h3 {
        font-size: 1.1rem;
    }

    #popup li {
        font-size: 0.8rem;
    }
}


    </style>
</head>
<body>
    <div class="map-container">
        <div class="map-title">Event Map</div>
        <div class="map-wrapper">
            <object data="map1.svg" type="image/svg+xml" id="svg-map" class="map-image"></object>

        </div>
        <div id="popup"></div>
    </div>
    
    <script>
       
       document.addEventListener("DOMContentLoaded", function () {
    console.log("DOM fully loaded and parsed.");

    const map = document.getElementById("svg-map");
    const popup = document.getElementById("popup");

    // Mapping block IDs to actual block names
    const blockNames = {
        block1: "AB BLOCK",
        block2: "CLC",
        block3: "AMPHITHEATRE",
        block4: "RB BLOCK",
        block5: "NORTH BLOCK",
        block6: "SOUTH BLOCK",
        block7: "VB",
        block8: "AMENITY",
        block9: "MINI AUDITORIUM",
        block10: "AK BLOCK",
        block11: "LAB1",
        block12: "LAB2",
        block13: "LAB3",
        block14: "LAB4"
    };

    map.addEventListener("load", function () {
        console.log("SVG map loaded.");

        const svgDoc = map.contentDocument || map.contentWindow.document;
        if (!svgDoc) {
            console.error("SVG document not loaded properly.");
            return;
        }

        const blocks = svgDoc.querySelectorAll("[id^='block']");
        console.log(`Found ${blocks.length} blocks.`);

        blocks.forEach(block => {
            block.style.cursor = "pointer";
            console.log(`Added event listener for ${block.id}`);

            block.addEventListener("click", async function (event) {
                const blockId = block.id;
                const blockName = blockNames[blockId] || "Unknown Block"; // Use mapped name or default text
                console.log(`Block clicked: ${blockName} (${blockId})`);

                try {
                    console.log(`Fetching events for ${blockName}...`);
                    const response = await fetch(`http://localhost:5004/api/event-venue?blockId=${blockId}`);

                    if (!response.ok) {
                        console.error(`Error fetching data: ${response.status}`);
                        return;
                    }

                    const eventData = await response.json();
                    console.log(`Fetched data for ${blockName}:`, eventData);

                    if (eventData.length === 0) {
                        popup.innerHTML = `<h3>No Events at ${blockName}</h3>`;
                        console.log(`No events found for ${blockName}`);
                    } else {
                        popup.innerHTML = `<h3>Events at ${blockName}</h3><ul>` +
                            eventData.map(e => `<li>${e.eventName} - ${e.eventTime} @ ${e.venue}</li>`).join("") + "</ul>";
                        console.log(`Events displayed for ${blockName}`);
                    }

                    popup.style.display = "block";
                } catch (error) {
                    console.error("Error fetching events:", error);
                }
            });
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
    const map = document.getElementById("svg-map");
    
    let isPanning = false, startX, startY, startViewBox;
    
    // Get SVG document from <embed>
    map.addEventListener("load", function () {
        const svgDoc = map.getSVGDocument();
        const svg = svgDoc.documentElement; // Main SVG element
        
        // Set a default viewBox for better scaling
        if (!svg.hasAttribute("viewBox")) {
            let width = svg.getAttribute("width") || 1000;
            let height = svg.getAttribute("height") || 1000;
            svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
        }
        
        // Zoom functionality
        svg.addEventListener("wheel", function (event) {
            event.preventDefault();
            let viewBox = svg.getAttribute("viewBox").split(" ").map(Number);
            let zoomFactor = event.deltaY > 0 ? 1.1 : 0.9; // Zoom in or out
            
            viewBox[2] *= zoomFactor;
            viewBox[3] *= zoomFactor;
            svg.setAttribute("viewBox", viewBox.join(" "));
        });

        // Enable panning on drag
        svg.addEventListener("mousedown", function (event) {
            isPanning = true;
            startX = event.clientX;
            startY = event.clientY;
            startViewBox = svg.getAttribute("viewBox").split(" ").map(Number);
        });

        svg.addEventListener("mousemove", function (event) {
            if (!isPanning) return;
            let dx = (startX - event.clientX) * (startViewBox[2] / svg.clientWidth);
            let dy = (startY - event.clientY) * (startViewBox[3] / svg.clientHeight);

            svg.setAttribute("viewBox", `${startViewBox[0] + dx} ${startViewBox[1] + dy} ${startViewBox[2]} ${startViewBox[3]}`);
        });

        svg.addEventListener("mouseup", function () {
            isPanning = false;
        });

        svg.addEventListener("mouseleave", function () {
            isPanning = false;
        });
    });
});


    </script>
</body>
</html>
